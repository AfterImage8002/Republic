### search_filters = {FOCUS_FILTER_POLITICAL}
### search_filters = {FOCUS_FILTER_RESEARCH}
### search_filters = {FOCUS_FILTER_INDUSTRY}
### search_filters = {FOCUS_FILTER_STABILITY}
### search_filters = {FOCUS_FILTER_WAR_SUPPORT}
### search_filters = {FOCUS_FILTER_MANPOWER}
### search_filters = {FOCUS_FILTER_ANNEXATION}
### search_filters = {FOCUS_FILTER_SOV_POLITICAL_PARANOIA}
### search_filters = {FOCUS_FILTER_PROPAGANDA}
### search_filters = {FOCUS_FILTER_ARMY_XP}
### search_filters = {FOCUS_FILTER_NAVY_XP}
### search_filters = {FOCUS_FILTER_AIR_XP}
# Reminder that focus filters prio has to be handled in the generic focus file :)

focus_tree = {
	id = russia_focus

	country = {
		factor = 0
		
		modifier = {
			add = 10
			tag = RAW
		}
	}
	
	default = no

	continuous_focus_position = { x = 55 y = 1500 }

		focus = {
		id = SOV_beaten_but_not_defeated
		icon = GFX_goal_generic_war_with_comintern
		x = 1
		y = 0
		relative_position_id = SOV_the_path_of_marxism_leninism
		offset = {
			x = -44
			y = 0
			trigger = { #All commie branches hide except for Stalinist
				has_game_rule = {
					rule = obsolete_focus_branches_visibility
					option = HIDE
				}
				has_completed_focus = SOV_beaten_but_not_defeated
			}
		}
		mutually_exclusive = { focus = SOV_the_path_of_marxism_leninism }

		cost = 5
		ai_will_do = {
			factor = 1
		}
		available = {
			custom_trigger_tooltip = {
				tooltip = SOV_no_major_purge_tt		
				check_variable = { SOV_great_purge_counter < 1 }
			}
		}

		available_if_capitulated = yes
		
		search_filters = {FOCUS_FILTER_POLITICAL}

		completion_reward = {
			custom_effect_tooltip = SOV_beaten_but_not_defeated_tt
			add_political_power = 25
			hidden_effect = {
				country_event = {
					id = NSB_soviet_paranoia_system_events.01 # Trigger paranoia if not already active
					hours = 6 
					random_hours = 24
				}
				set_variable = { SOV_exiles_army_support = 0.1 }
				set_variable = { SOV_exiles_navy_support = 0.02 }
				set_variable = { SOV_exiles_air_support = 0.02 } 
				# Launch the first Stalinist counter measures
				SOV_launch_stalinist_counter_measure = yes 
				SOV_get_centre_military_support = yes
			}
			mark_focus_tree_layout_dirty = yes
		}
	}

	focus = {
		id = SOV_unification_of_the_exiles
		icon = GFX_goal_generic_major_alliance
		prerequisite = { focus = SOV_beaten_but_not_defeated }
		x = 0
		y = 1
		relative_position_id = SOV_beaten_but_not_defeated
		available = {
			SOV_soviet_civil_war_not_started = yes 
		}

		bypass = {
			OR = {
				has_global_flag = SOV_soviet_civil_war_over
				has_global_flag = SOV_soviet_civil_war
			}
		}

		cost = 10
		ai_will_do = {
			factor = 1
		}

		available_if_capitulated = yes
		
		search_filters = {FOCUS_FILTER_POLITICAL FOCUS_FILTER_SOV_POLITICAL_PARANOIA}

		completion_reward = {
			add_political_power = 75
			SOV_paranoia_low_increase_effect = yes
			custom_effect_tooltip = SOV_unification_of_the_exiles_tt
		}
	}

	focus = {
		id = SOV_womens_fascist_movement
		icon = GFX_focus_SOV_womens_fascist_movement
		prerequisite = { focus = SOV_unification_of_the_exiles }
		x = -2
		y = 1
		relative_position_id = SOV_unification_of_the_exiles
		cost = 5
		ai_will_do = {
			factor = 1
		}
		available = {
			SOV_soviet_civil_war_not_started = yes 
		}

		bypass = {
			OR = {
				has_global_flag = SOV_soviet_civil_war_over
				has_global_flag = SOV_soviet_civil_war
			}
		}

		available_if_capitulated = yes

		search_filters = {FOCUS_FILTER_MANPOWER FOCUS_FILTER_INDUSTRY}

		completion_reward = {
			add_popularity = {
				ideology = fascism
				popularity = 0.05
			}
			custom_effect_tooltip = SOV_fascist_womens_movement_tt
			effect_tooltip = { add_ideas = SOV_fascist_womens_movement_idea }
			set_country_flag = SOV_fascist_womens_movement_flag
		}
		
	}

	focus = {
		id = SOV_the_true_tsars
		icon = GFX_focus_SOV_the_true_tsars
		prerequisite = { focus = SOV_unification_of_the_exiles }
		x = 0
		y = 1
		relative_position_id = SOV_unification_of_the_exiles
		cost = 5
		ai_will_do = {
			factor = 1
		}
		available = {
			SOV_soviet_civil_war_not_started = yes 
		}

		bypass = {
			OR = {
				has_global_flag = SOV_soviet_civil_war_over
				has_global_flag = SOV_soviet_civil_war
			}
		}

		available_if_capitulated = yes
		
		search_filters = {FOCUS_FILTER_MANPOWER FOCUS_FILTER_STABILITY}

		completion_reward = {
			add_popularity = {
				ideology = fascism
				popularity = 0.05
			}
			add_popularity = {
				ideology = neutrality
				popularity = 0.1
			}
			custom_effect_tooltip = SOV_the_true_tsars_tt
			effect_tooltip = { add_ideas = SOV_the_true_tsars_idea }		
			set_country_flag = SOV_the_true_tsars_flag
		}
	}

	focus = {
		id = SOV_national_unification
		icon = GFX_goal_generic_construct_mil_factory
		prerequisite = { focus = SOV_unification_of_the_exiles }
		x = 2
		y = 1
		relative_position_id = SOV_unification_of_the_exiles
		cost = 5
		ai_will_do = {
			factor = 1
		}
		available = {
			SOV_soviet_civil_war_not_started = yes 
		}

		bypass = {
			OR = {
				has_global_flag = SOV_soviet_civil_war_over
				has_global_flag = SOV_soviet_civil_war
			}
		}

		available_if_capitulated = yes
		
		search_filters = {FOCUS_FILTER_POLITICAL FOCUS_FILTER_INDUSTRY}

		completion_reward = {
			add_popularity = {
				ideology = fascism
				popularity = 0.15
			}
			add_popularity = {
				ideology = neutrality
				popularity = 0.1
			}	
			custom_effect_tooltip = SOV_national_unification_tt 
			set_country_flag = SOV_national_unification_flag
		}
	}


	focus = {
		id = SOV_embrace_the_black_hundreds
		icon = GFX_focus_generic_little_entente
		prerequisite = { 
			focus = SOV_womens_fascist_movement
			focus = SOV_the_true_tsars
			focus = SOV_national_unification
		}
		x = 0
		y = 1
		relative_position_id = SOV_the_true_tsars
		cost = 5
		ai_will_do = {
			factor = 1
		}
		available = {

		}

		bypass = {
			OR = {
				has_global_flag = SOV_soviet_civil_war_over
				has_global_flag = SOV_soviet_civil_war
			}
		}

		available_if_capitulated = yes
		
		search_filters = {}

		completion_reward = {
			set_country_flag = SOV_embrace_the_black_hundreds_flag
			custom_effect_tooltip = SOV_embrace_the_black_hundreds_tt
			add_political_power = 50 
		}

	}
	focus = {
		id = SOV_covert_operations
		icon = GFX_goal_generic_more_territorial_claims
		prerequisite = { focus = SOV_embrace_the_black_hundreds }
		x = -3
		y = 1
		relative_position_id = SOV_embrace_the_black_hundreds
		cost = 5
		ai_will_do = {
			factor = 1
		}
		available = {
			SOV_soviet_civil_war_not_started = yes 
		}

		bypass = {
		
		}

		available_if_capitulated = yes
		
		search_filters = {FOCUS_FILTER_POLITICAL FOCUS_FILTER_INDUSTRY}

		completion_reward = {
			add_political_power = 50
			custom_effect_tooltip = SOV_covert_operations_tt
		}
	}

	focus = {
		id = SOV_muster_the_old_guard
		icon = GFX_focus_generic_military_mission
		prerequisite = { 
			focus = SOV_embrace_the_black_hundreds
		}
		x = -1
		y = 1
		relative_position_id = SOV_embrace_the_black_hundreds
		cost = 10
		ai_will_do = {
			factor = 1
		}
		available = {
			SOV_soviet_civil_war_not_started = yes 
		}

		bypass = {
			OR = {
				has_global_flag = SOV_soviet_civil_war_over
				has_global_flag = SOV_soviet_civil_war
			}
		}

		available_if_capitulated = yes
		
		search_filters = {}

		completion_reward = {
			custom_effect_tooltip = SOV_muster_the_old_guard_tt
			add_popularity = {
				ideology = neutrality
				popularity = 0.1
			}
			set_country_flag = SOV_muster_the_old_guard_flag
		}
	}
	focus = {
		id = SOV_approach_semyonov
		icon = GFX_focus_SOV_approach_semyonov
		prerequisite = { 
			focus = SOV_embrace_the_black_hundreds
		}
		x = 3
		y = 1
		relative_position_id = SOV_embrace_the_black_hundreds
		cost = 5
		ai_will_do = {
			factor = 1
		}
		available = {
			SOV_soviet_civil_war_not_started = yes 
		}

		bypass = {
			
		}

		available_if_capitulated = yes
		
		search_filters = {}

		completion_reward = {
			custom_effect_tooltip = SOV_approach_semyonov_tt
			add_command_power = 25
		}
	}

	focus = {
		id = SOV_fascist_youth_union
		icon = GFX_goal_generic_small_arms
		prerequisite = { 
			focus = SOV_embrace_the_black_hundreds
		}
		x = 1
		y = 1
		relative_position_id = SOV_embrace_the_black_hundreds
		cost = 10
		ai_will_do = {
			factor = 1
		}
		available = {
			SOV_soviet_civil_war_not_started = yes 
		}

		bypass = {
			OR = {
				has_global_flag = SOV_soviet_civil_war_over
				has_global_flag = SOV_soviet_civil_war
			}
		}

		available_if_capitulated = yes
		
		search_filters = {}

		completion_reward = {
			set_country_flag = SOV_fascist_youth_union_flag
			custom_effect_tooltip = SOV_fascist_youth_union_tt
			add_popularity = {
				ideology = fascism
				popularity = 0.05
			}	
		}
	}
	focus = {
		id = SOV_tolkachi 
		icon = GFX_goal_generic_intelligence_exchange
		prerequisite = { 
			focus = SOV_muster_the_old_guard
			focus = SOV_fascist_youth_union
			
		}
		x = 1
		y = 1
		relative_position_id = SOV_muster_the_old_guard
		cost = 5
		ai_will_do = {
			factor = 1
		}
		available = {
			SOV_soviet_civil_war_not_started = yes 
		}

		bypass = {
			OR = {
				has_global_flag = SOV_soviet_civil_war_over
				has_global_flag = SOV_soviet_civil_war
			}
		}

		available_if_capitulated = yes
		
		search_filters = {}

		completion_reward = {
			set_country_flag = SOV_tolkachi_flag
			custom_effect_tooltip = SOV_tolkachi_tt
		}
	}

	focus = {
		id = SOV_south_manchuria_railway
		icon = GFX_focus_SOV_south_manchuria_railway
		prerequisite = { 
			focus = SOV_muster_the_old_guard
			focus = SOV_fascist_youth_union	
		}
		x = 1
		y = 1
		relative_position_id = SOV_fascist_youth_union
		cost = 5
		ai_will_do = {
			factor = 1
		}
		available = {
			SOV_soviet_civil_war_not_started = yes 
		}

		bypass = {
			
		}

		available_if_capitulated = yes
		
		search_filters = {FOCUS_FILTER_SOV_POLITICAL_PARANOIA}

		completion_reward = {
			 SOV_paranoia_low_increase_effect = yes
			 custom_effect_tooltip = SOV_sway_the_railway_workers_tt
			 set_country_flag = SOV_supply_hub_flag
		}
	}

	focus = {
		id = SOV_organize_wreckers
		icon = GFX_focus_SOV_organize_wreckers
		prerequisite = { 
			focus = SOV_muster_the_old_guard
			focus = SOV_fascist_youth_union
			
		}
		x = -1
		y = 1
		relative_position_id = SOV_muster_the_old_guard
		cost = 5
		ai_will_do = {
			factor = 1
		}
		available = {
			SOV_soviet_civil_war_not_started = yes 
		}

		bypass = {
			
		}

		available_if_capitulated = yes
		
		search_filters = {FOCUS_FILTER_SOV_POLITICAL_PARANOIA}

		completion_reward = {
			 set_country_flag = SOV_organize_wreckers_flag
			 SOV_paranoia_medium_increase_effect = yes
			 custom_effect_tooltip = SOV_organize_wreckers_tt
		}
	}

	focus = {
		id = SOV_the_eyes_fear
		icon = GFX_goal_generic_secret_weapon
		prerequisite = { 
			focus = SOV_tolkachi
			focus = SOV_organize_wreckers
			focus = SOV_south_manchuria_railway
		}
		x = 0
		y = 1
		relative_position_id = SOV_tolkachi
		cost = 5
		ai_will_do = {
			factor = 1
		}
		
		available = {
			SOV = { 
				
			}
			SOV_soviet_civil_war_not_started = yes 
		}

		bypass = {
			OR = {
				has_global_flag = SOV_soviet_civil_war_over
				has_global_flag = SOV_soviet_civil_war
			}
		}

		available_if_capitulated = yes
		
		search_filters = {}

		completion_reward = {
			#create unit after war begins - 15 infantry, split between ukraine and siberia (7 and 8)
			set_country_flag = Sov_the_eyes_fear_flag
			custom_effect_tooltip = SOV_the_eyes_fear_tt
		}
	}

	focus = {
		id = SOV_the_hands_do
		icon = GFX_goal_generic_major_war
		prerequisite = { 
			focus = SOV_the_eyes_fear
		}
		x = 0
		y = 1
		relative_position_id = SOV_the_eyes_fear
		cost = 5
		ai_will_do = {
			factor = 1
		}
		available = {
			SOV_soviet_civil_war_not_started = yes 
		}

		bypass = {
			OR = {
				has_global_flag = SOV_soviet_civil_war_over
				has_global_flag = SOV_soviet_civil_war
			}
		}

		available_if_capitulated = yes
		
		search_filters = {}

		completion_reward = {
			country_event = { 
				id = NSB_Soviet_fascist_civil_war.001 hours = 6 random_hours = 6 
			}
			SOV_opposition_support_high_increase_effect = yes 
			SOV_increase_opposition_army_support = yes
			custom_effect_tooltip = SOV_the_hands_do_tt

			mark_focus_tree_layout_dirty = yes
		}
	}
	focus = {
		id = SOV_call_for_aid
		icon = GFX_goal_tripartite_pact
		prerequisite = { focus = SOV_the_hands_do }
		x = -3
		y = 1
		relative_position_id = SOV_the_hands_do
		cost = 5
		ai_will_do = {
			factor = 1
		}

		available_if_capitulated = yes
		
		search_filters = {}

		completion_reward = {
			every_other_country = {
				limit = {
					is_major = yes
					OR = {
						has_government = fascism
						AND = {
							tag = JAP
							has_government = neutrality
						}
						AND = {
							tag = ITA
							has_government = neutrality
						}
						AND = {
							tag = GER
							has_government = neutrality
						}
						AND = {
							tag = ENG
							has_government = neutrality
						}
					}
				}
				add_timed_idea = { idea = SOV_national_brotherhood_idea days = 730 }
				add_opinion_modifier = { target = ROOT modifier = SOV_support_for_exiles }
				add_ai_strategy = {
					type = send_volunteers_desire
					id = SOV
					value = 400
				}
				add_ai_strategy = {
					type = send_lend_lease_desire
					id = SOV
					value = 300
				}
			}
		}
	}

	focus = {
		id = SOV_request_imperial_protection 
		icon = GFX_focus_jap_showa_restoration
		prerequisite = { focus = SOV_call_for_aid }
		x = 0
		y = 1
		relative_position_id = SOV_call_for_aid
		cost = 10
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0 # No point asking for japanese help if we are winning, unless we get stuck
				surrender_progress < 0.1
				SOS = { surrender_progress > 0.5 }
				date < 1938.6.1
			}
			modifier = {
				factor = 0 # Never ask if we are close to winning, unless we are close to 1940
				SOS = { surrender_progress > 0.75 }
				date < 1939.8.1
			}
			modifier = {
				factor = 0 # Don't risk getting dragged into Chinese war unless desperate
				surrender_progress < 0.5
				JAP = { has_war = yes }
			}
		}
		available = {
			has_global_flag = SOV_soviet_civil_war
			OR = { 
				has_country_flag = SOV_CSW_transfer_vladivostok_flag
				has_country_flag = SOV_CSW_transfer_sakhalin_flag
			}
			
		}

		available_if_capitulated = yes
		
		search_filters = {}

		completion_reward = {
			JAP = {
				country_event = {
					id = NSB_soviet_civil_war_common.121
					days = 2
					random_days = 3
				}
			}
			custom_effect_tooltip = SOV_request_imperial_protection_tt
		}
	} 

	focus = {
		id = SOV_sabotage_behind_enemy_lines
		icon = GFX_focus_prc_infiltration
		prerequisite = { focus = SOV_the_hands_do }
		x = -1
		y = 1
		relative_position_id = SOV_the_hands_do
		cost = 5
		ai_will_do = {
			factor = 1
		}
		available = {
			has_global_flag = SOV_soviet_civil_war
		}

		available_if_capitulated = yes
		
		search_filters = {}

		completion_reward = {
			unlock_decision_tooltip = {
				decision = SOV_sabotage_behind_enemy_lines_decision
				show_effect_tooltip = yes 
				show_modifiers = no
			}

			#hidden_effect = {
			#	every_state = {
			#		limit = {
			#			OR = {
			#				is_owned_by = SOV
			#				is_owned_by = SOS
			#			}
			#			
			#		}
			#		damage_units = {
			#			state = THIS
			#			limit = { tag = SOS } 
			#			org_damage = 0.15
			#			str_damage = 0.01
			#			ratio = yes 
			#			army = yes
			#		}
			#	}
			#}
		}
	}

	focus = {
		id = SOV_aristocratic_investments
		icon = GFX_focus_generic_industry_3
		prerequisite = { focus = SOV_the_hands_do }
		x = 1
		y = 1
		relative_position_id = SOV_the_hands_do 
		cost = 10
		ai_will_do = {
			factor = 1
		}

		available_if_capitulated = no
		
		search_filters = {FOCUS_FILTER_INDUSTRY}

		completion_reward = {
			add_timed_idea = {
				idea = SOV_aristocratic_investments_idea
				days = 730
			}
			random_owned_controlled_state = {
				add_extra_state_shared_building_slots = 2
				add_building_construction = {
					type = arms_factory
					level = 2
					instant_build = yes
				}
				set_state_flag = SOV_national_unification_factory_bonus_flag
			}
			random_owned_controlled_state = {
				limit = {
					Not = { has_state_flag = SOV_national_unification_factory_bonus_flag}
				}
				add_extra_state_shared_building_slots = 2
				add_building_construction = {
					type = arms_factory
					level = 2
					instant_build = yes
				}
			}
			#TODO jo remove this once the civil war ends
		}
	}

	focus = {
		id = SOV_consolidate_power
		icon = GFX_goal_generic_political_pressure
		prerequisite = { focus = SOV_the_hands_do }
		x = 0
		y = 2
		relative_position_id = SOV_the_hands_do
		cost = 5
		ai_will_do = {
			factor = 1
		}
		available = {
			has_global_flag = SOV_soviet_civil_war_over
		}

		available_if_capitulated = no
		
		search_filters = {FOCUS_FILTER_POLITICAL FOCUS_FILTER_STABILITY}

		completion_reward = {
			add_timed_idea = {
				idea = SOV_consolidate_power
				days = 365
			}
			custom_effect_tooltip = SOV_consolidate_power_tt
		}
	}

	focus = {
		id = SOV_rebuild_the_nation
		icon = GFX_goal_generic_construct_civilian
		prerequisite = { focus = SOV_consolidate_power }
		x = 0
		y = 1
		relative_position_id = SOV_consolidate_power
		cost = 5
		ai_will_do = {
			factor = 1
		}
		available = { has_war = no }

		available_if_capitulated = no
		
		search_filters = {FOCUS_FILTER_POLITICAL}

		completion_reward = {
			add_timed_idea = {
				idea = SOV_rebuild_the_nation
				days = 540
			}
		}
	}

	focus = {
		id = SOV_bringing_breakaways_back_to_the_fold
		icon = GFX_goal_generic_demand_territory
		prerequisite = { focus = SOV_consolidate_power }
		x = -2
		y = 1
		relative_position_id = SOV_consolidate_power
		mutually_exclusive = { focus = SOV_offer_autonomy_to_former_soviet_republics }
		cost = 10
		ai_will_do = {
			factor = 1
		}
		available = {
			any_country = {
				has_country_flag = SOV_breakaway_country_flag
			}
		}

		available_if_capitulated = no
		
		search_filters = {FOCUS_FILTER_POLITICAL}

		completion_reward = {
			every_country = {
				limit = {
					has_country_flag = SOV_breakaway_country_flag
				}
				ROOT = {
					create_wargoal = {
						type = take_core_state 
						target = PREV
					}
				}
			}
			
		}
	}
	focus = {
		id = SOV_offer_autonomy_to_former_soviet_republics 
		icon = GFX_goal_generic_forceful_treaty
		prerequisite = { focus = SOV_consolidate_power }
		x = -4
		y = 1
		relative_position_id = SOV_consolidate_power
		mutually_exclusive = { focus = SOV_bringing_breakaways_back_to_the_fold }
		cost = 5
		ai_will_do = {
			factor = 1
		}
		available = {
			any_country = {
				has_country_flag = SOV_breakaway_country_flag
			}
		}

		available_if_capitulated = no
		
		search_filters = {FOCUS_FILTER_INDUSTRY}

		completion_reward = {
			every_country = {
				limit = {
					has_country_flag = SOV_breakaway_country_flag
					NOT = { is_in_faction_with = ROOT }
				}
				country_event = {
					id = NSB_soviet_nationalist.002
					days = 3
					random_days = 3
				}
			}
			
		}
	}

	focus = {
		id = SOV_restore_the_glory_of_the_motherland
		icon = GFX_goal_generic_construction
		prerequisite = { focus = SOV_rebuild_the_nation }
		x = 0
		y = 1
		relative_position_id = SOV_rebuild_the_nation
		cost = 10
		ai_will_do = {
			factor = 1
		}

		available_if_capitulated = no
		
		search_filters = {FOCUS_FILTER_INDUSTRY}

		completion_reward = {
			add_ideas = SOV_restore_the_glory_of_the_motherland
		}
	}

}